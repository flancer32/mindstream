# Architecture — Semantic Representation: Embeddings

Path: `ctx/docs/architecture/representations/embeddings.md`

## Назначение

Документ фиксирует нормативную модель эмбеддингов в MVP Mindstream: какие эмбеддинги считаются каноническими, из каких текстов они рассчитываются, когда считаются, и какие инварианты обязаны соблюдаться.

Документ не описывает алгоритмы кластеризации и построения ленты; он фиксирует форму данных и правила их формирования.

---

## Смысловые объекты и их эмбеддинги

Для каждой публикации в MVP существует ровно два эмбеддинга:

1. Embedding(Annotation) — эмбеддинг md-аннотации публикации.
2. Embedding(Overview) — эмбеддинг md-обзора публикации.

Эмбеддинги привязаны к публикации целиком и считаются обязательной частью данных продукта.

---

## Источник текста

Единственный допустимый источник текста для расчёта эмбеддингов — md-аннотация и md-обзор, уже сохранённые в базе данных.

Расчёт эмбеддинга “на лету” во время генерации текста запрещён.

---

## Идемпотентность и неизменяемость

Расчёт эмбеддингов строго идемпотентен:

- если эмбеддинг уже существует, он не пересчитывается;
- повторная генерация/пересчёт эмбеддингов для публикации в MVP запрещены.

---

## Момент расчёта

Эмбеддинги рассчитываются отдельной CLI-командой processing-контура и не инициируются автоматически командами ingestion или генерации смысловых представлений.

---

## Ошибки

Ошибка расчёта эмбеддинга блокирует публикацию целиком:

- публикация переводится в ошибочное состояние processing-контура;
- публикация не может участвовать в runtime-контуре (в ленте пользователя);
- допускается повторный запуск команды для обработки других публикаций, но для данной публикации считается, что processing завершён ошибкой.

---

## Модель эмбеддингов

В MVP используется фиксированная embedding-модель (часть нормативного контракта). Изменение модели считается изменением архитектурного контракта и требует явного изменения данного документа и связанных документов схемы/хранилища.
