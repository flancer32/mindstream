# HTTP Ingress

Path: `ctx/docs/architecture/ingress/http-ingress.md`

## Назначение

**HTTP Ingress** — это архитектурная граница Mindstream, через которую система принимает все внешние HTTP-запросы из веб-контекста и иных HTTP-клиентов.

HTTP Ingress является **основным внешним интерфейсом** системы в рамках MVP и единственной архитектурно допустимой точкой входа для сервисов, предназначенных для HTTP-доступа.

---

## Границы ответственности

HTTP Ingress отвечает за:

- приём внешних HTTP-запросов;
- передачу управления во внутреннее backend-приложение;
- обеспечение единой, контролируемой и изолированной HTTP-границы системы.

HTTP Ingress **не отвечает** за:

- бизнес-логику обработки данных;
- управление жизненным циклом доменных сущностей;
- хранение и интерпретацию данных;
- принятие продуктовых решений.

CLI-команды являются отдельным ingress-каналом и **не относятся** к HTTP Ingress.

---

## Архитектурные инварианты (MVP)

В рамках MVP зафиксированы следующие инварианты:

1. **Apache является обязательным компонентом runtime-контура.**  
   Все внешние HTTP-запросы к системе проходят через Apache.

2. **Прямой внешний доступ к Node-приложению недопустим.**  
   Node-приложение не экспонируется напрямую во внешнюю сеть. Прямой доступ допустим только в dev- или тестовых контурах.

3. **HTTP Ingress канонически реализован через `@flancer32/teq-web`.**  
   Dispatcher-модель `@flancer32/teq-web` (pre / process / post) является частью архитектурного инварианта MVP. Альтернативные HTTP-входы или библиотеки не предусматриваются.

---

## Границы HTTP API

В рамках HTTP Ingress архитектурно выделяется пространство HTTP API.

- Пространство `/api/**` предназначено **исключительно** для сервисов, доступных из веб-контекста.
- Только веб-доступные сервисы могут быть размещены под `/api/**`.

CLI-команды:

- не являются частью HTTP API;
- не экспонируются через `/api/**`;
- не допускаются к вызову через HTTP Ingress.

HTTP Ingress **не ограничивается** пространством `/api/**`. Архитектура допускает наличие других HTTP-обработчиков вне `/api/**` (например, SSR или иные web-механизмы), при условии, что они не нарушают архитектурные инварианты системы.

---

## Роль Apache

Apache в рамках HTTP Ingress выполняет следующие архитектурные функции:

- TLS termination;
- маршрутизацию HTTP-запросов;
- проксирование запросов, относящихся к HTTP Ingress, во внутреннее Node-приложение;
- раздачу статических ресурсов и SPA.

Apache является частью **реализации** HTTP Ingress, но не тождественен ему как архитектурному понятию.

---

## Anonymous Identity и HTTP Ingress (MVP)

В рамках MVP HTTP Ingress работает **исключительно с anonymous identity**, а не с пользователями.

Anonymous identity:

- представлена UUID стандартного формата;
- генерируется **на стороне фронта**;
- регистрируется на сервере явным образом;
- используется как технический идентификатор источника статистических сигналов.

HTTP Ingress:

- **не генерирует UUID**;
- **не управляет lifecycle identity**;
- **не интерпретирует identity как пользователя**;
- **не реализует аутентификацию или авторизацию**.

Все write-операции, требующие идентификации источника, допускаются **только при наличии зарегистрированной anonymous identity**. Запросы, не содержащие зарегистрированной identity, считаются архитектурно недопустимыми для соответствующих write-путей.

Иные механизмы идентификации (логины, email, пароли, роли, ACL, OAuth и т.п.) в рамках MVP отсутствуют.

---

## Контекст использования

HTTP Ingress предназначен для обработки HTTP-запросов, инициируемых из веб-контекста, включая:

- доставку read-моделей во фронтенд;
- приём write-событий статистического характера при выполнении архитектурных условий.

Поведение конкретных маршрутов, форматы API, способы сериализации данных и реализация endpoint-обработчиков **не фиксируются** на архитектурном уровне и относятся к уровню реализации.

---

## Связанные архитектурные документы

- `ctx/docs/architecture/anonymous-identity.md` — нормативная модель anonymous identity.
- `ctx/docs/architecture/ingress/frontend-data-ingress.md` — read-ingress во фронтенд.
- `ctx/docs/architecture/data-flow/attention.md` — потоки сигналов внимания.
- `ctx/docs/architecture/runtime/http-runtime.md` — runtime-граница HTTP.
