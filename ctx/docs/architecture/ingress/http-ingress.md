# HTTP Ingress

Path: `ctx/docs/architecture/ingress/http-ingress.md`

## Назначение

**HTTP Ingress** — это архитектурная граница Mindstream, через которую система принимает все внешние HTTP-запросы от пользователей и клиентских приложений.

HTTP Ingress является **основным внешним интерфейсом** системы в MVP и единственной точкой входа для сервисов, предназначенных для веб-доступа.

---

## Границы ответственности

HTTP Ingress отвечает за:

- приём внешних HTTP-запросов;
- передачу управления во внутреннее backend-приложение;
- обеспечение единой и контролируемой HTTP-границы системы.

CLI-команды являются отдельным ingress-каналом и **не относятся** к HTTP Ingress.

---

## Архитектурные инварианты (MVP)

В рамках MVP зафиксированы следующие инварианты:

1. **Apache является обязательным компонентом runtime-контура.**  
   Все внешние HTTP-запросы к системе проходят через Apache.

2. **Прямой внешний доступ к Node-приложению недопустим.**  
   Node-приложение не экспонируется напрямую во внешнюю сеть. Прямой доступ возможен только в dev- или тестовых контурах.

3. **HTTP Ingress канонически реализован через `@flancer32/teq-web`.**  
   Dispatcher-модель `@flancer32/teq-web` (pre / process / post) является частью архитектурного инварианта MVP. Альтернативные HTTP-входы или библиотеки не предусматриваются.

---

## Границы HTTP API

В рамках HTTP Ingress архитектурно выделяется пространство HTTP API.

- Пространство `/api/**` предназначено **исключительно** для сервисов, доступных из веб-контекста.
- Только веб-доступные сервисы могут быть размещены под `/api/**`.

CLI-команды:

- не являются частью HTTP API;
- не экспонируются через `/api/**`;
- не допускаются к вызову через HTTP Ingress.

HTTP Ingress **не ограничивается** пространством `/api/**`. Архитектура допускает наличие других HTTP-обработчиков вне `/api/**` (например, SSR или иные веб-механизмы), если они не нарушают архитектурные инварианты системы.

---

## Роль Apache

Apache в рамках HTTP Ingress выполняет следующие архитектурные функции:

- TLS termination;
- маршрутизацию HTTP-запросов;
- проксирование запросов, относящихся к HTTP Ingress, во внутреннее Node-приложение;
- раздачу статики и SPA.

Apache является частью реализации HTTP Ingress, но не заменяет его как архитектурное понятие.

---

## Идентификация пользователя (MVP)

В рамках MVP используется только UUID-идентификация пользователя.

UUID:

- генерируется сервером;
- передаётся в браузер;
- используется как единственный идентификатор пользователя.

Иные механизмы аутентификации и авторизации (логины, пароли, роли, ACL, OAuth и т.п.) отсутствуют.  
У кого есть UUID — тот и пользователь.

---

## Контекст использования

HTTP Ingress предназначен для обработки HTTP-запросов, инициируемых из веб-контекста.

Поведение конкретных маршрутов, форматы API, способы сериализации данных и реализация обработчиков не фиксируются на архитектурном уровне и относятся к уровню реализации.
