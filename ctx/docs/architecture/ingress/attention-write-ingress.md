# Attention Write Ingress

Path: `ctx/docs/architecture/ingress/attention-write-ingress.md`

## Назначение

**Attention Write Ingress** — это специализированная архитектурная граница Mindstream, через которую система принимает **write-события сигналов внимания**, возникающие в браузерном контексте в результате пользовательского взаимодействия с персональной лентой.

Данный ingress предназначен исключительно для фиксации статистических фактов внимания и не является каналом управления, персонализации или чтения данных.

---

## Архитектурная позиция

Attention Write Ingress:

- является подмножеством HTTP Ingress;
- обслуживает только write-потоки;
- относится к классу **Attention Signal Flows**;
- соединяет браузерный контур сигналов внимания с серверным контуром хранения.

Ingress не участвует в потоках формирования корпуса и не влияет на каноническое состояние корпусных данных.

---

## Границы ответственности

Attention Write Ingress отвечает за:

- приём write-событий сигналов внимания из браузерного контекста;
- проверку архитектурной допустимости события;
- передачу допустимых событий во внутренний контур хранения.

Attention Write Ingress **не отвечает** за:

- формирование или интерпретацию interest vector;
- агрегирование статистики;
- влияние на порядок или состав персональной ленты;
- персонализацию ответов;
- предоставление read-доступа к данным.

---

## Инварианты ingress (MVP)

В рамках MVP зафиксированы следующие инварианты:

1. **Write-only характер**  
   Attention Write Ingress принимает только write-события. Read-операции через данный ingress архитектурно запрещены.

2. **Статистическая природа событий**  
   События трактуются как фиксация факта внимания, а не как команда или управляющее воздействие на систему.

3. **Отсутствие обратных связей**  
   Приём событий внимания не инициирует пересчёт корпуса данных, смысловых представлений или эмбеддингов.

4. **Fire-and-forget модель**  
   Ingress не обязан возвращать клиенту данные, используемые для дальнейшей логики браузерного контура.

---

## Anonymous Identity как обязательное условие

Все события, принимаемые Attention Write Ingress, обязаны быть связаны с **зарегистрированной anonymous identity**.

Архитектурные правила:

- ingress принимает события **только** при наличии зарегистрированной identity;
- события без identity архитектурно недопустимы;
- ingress не выполняет регистрацию identity;
- ingress не интерпретирует identity как пользователя.

Модель anonymous identity и её lifecycle зафиксированы в документе `ctx/docs/architecture/anonymous-identity.md`.

---

## Допустимые классы событий внимания

В рамках MVP Attention Write Ingress принимает только события, соответствующие архитектурно допустимым классам сигналов внимания.

Допустимые классы событий определяются как:

- факт открытия обзора публикации;
- факт перехода по ссылке на источник публикации;
- комбинированный факт: открытие обзора с последующим переходом по ссылке.

Перечень классов событий является **закрытым** в рамках MVP. Расширение перечня требует пересмотра архитектурного корпуса документации.

---

## Дедупликация и идемпотентность

Attention Write Ingress допускает повторную отправку идентичных событий со стороны браузерного контура.

Архитектурные инварианты:

- для одной anonymous identity допускается не более одного события одного типа для одной публикации;
- повторная отправка не должна приводить к изменению агрегированного состояния;
- обеспечение идемпотентности является инвариантом хранения, а не ingress-логики.

---

## Связь с потоками данных

Attention Write Ingress является архитектурной точкой входа для **Attention Signal Flows**, зафиксированных в документе:

- `ctx/docs/architecture/data-flow/attention.md`

Ingress не изменяет направленность потоков и не расширяет их роль.

---

## Ограничения и запреты

В рамках MVP через Attention Write Ingress запрещено:

- передавать агрегированные или интерпретированные данные;
- выполнять read-запросы;
- запрашивать состояние interest vector;
- влиять на формирование или доставку Feed View;
- использовать события внимания как управляющие команды;
- связывать события с IP-адресами или user-agent.

---

## Границы документа

Данный документ:

- не описывает API-эндпойнты и их форматы;
- не фиксирует DTO и структуры payload;
- не определяет транспортные механизмы (Beacon API и т.п.);
- не описывает реализацию ingress-обработчиков;
- не содержит продуктовых сценариев UI.

Все перечисленные вопросы относятся к уровню реализации или композиции и не фиксируются на архитектурном уровне.

---

## Связанные архитектурные документы

- `ctx/docs/architecture/anonymous-identity.md`
- `ctx/docs/architecture/ingress/http-ingress.md`
- `ctx/docs/architecture/data-flow/attention.md`
- `ctx/docs/architecture/attention/interest-vector.md`

---

## Итог

Attention Write Ingress фиксирует архитектурно допустимый write-путь для статистических сигналов внимания в MVP Mindstream, обеспечивая изоляцию пользовательских действий от канонического корпуса данных, отсутствие реактивных эффектов и строгую привязку к модели anonymous identity.
