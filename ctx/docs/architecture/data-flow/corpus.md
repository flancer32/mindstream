# Mindstream — Corpus Formation Data Flows

Path: `ctx/docs/architecture/data-flow/corpus.md`

## Назначение

Документ фиксирует потоки формирования корпуса данных в MVP Mindstream.

Под потоками формирования корпуса понимаются серверные потоки данных, в результате которых формируется и поддерживается канонический корпус смысловых данных, используемый всеми пользовательскими контекстами.

Документ описывает только **Corpus Formation Flows** и не затрагивает потоки передачи данных, потоки внимания или локальные вычисления браузерного контура.

---

## Архитектурная позиция

Потоки формирования корпуса данных относятся исключительно к контурам формирования корпуса и исполняются в серверной части системы.

Эти потоки:

- формируют каноническое состояние корпуса данных;
- не зависят от пользовательского поведения;
- не имеют обратных связей с браузерными контурами;
- не пересматривают ранее сформированные данные реактивно.

Результаты данных потоков являются инвариантными по отношению к пользователю и используются всеми пользовательскими контекстами одинаково.

---

## Общая структура потоков формирования корпуса

В рамках MVP формирование корпуса данных осуществляется как совокупность согласованных серверных потоков, каждый из которых имеет чётко определённый вход, результат и архитектурные инварианты.

![Corpus Formation Flows](../../_img/mindstream_arch_data_flow_corpus.svg)

Схема: **Corpus Formation Flows**.

---

## Поток агрегации и подготовки публикаций

(`Publication Sources → Ingestion`)

**Назначение**  
Получение публикаций из внешних источников и формирование внутреннего текстового представления, допустимого для дальнейшей смысловой обработки.

**Входные данные**  
Внешние публикации, доступные через внешний источник или ссылку.

**Результат потока**  
Внутреннее представление публикации, содержащее извлечённый и смыслово нормализованный текст, пригодный для формирования смысловых представлений.

**Инварианты потока**

- поток инициируется исключительно серверным контуром;
- публикация либо принимается целиком, либо исключается из корпуса;
- отсутствие пригодного текстового представления делает дальнейшее продвижение публикации невозможным;
- результат потока не зависит от пользовательского контекста.

---

## Поток смысловой обработки публикаций

(`Ingestion → Primary Processing`)

**Назначение**  
Формирование смысловых представлений публикации как устойчивых LLM-производных артефактов.

**Результат потока**

- аннотация (Annotation);
- обзор (Overview).

**Свойства потока**

- аннотация и обзор формируются как алгоритмические проекции подготовленного текста публикации;
- сформированные смысловые представления не пересматриваются реактивно;
- отсутствие смысловых представлений означает архитектурную незавершённость обработки публикации.

**Инварианты потока**

- поток не зависит от сигналов внимания;
- повторная смысловая обработка одной и той же публикации не допускается в рамках MVP.

---

## Поток формирования эмбеддингов

(`Primary Processing → Embedding`)

**Назначение**  
Формирование векторных представлений смысловых проекций публикации, используемых для операций смыслового сопоставления.

**Источники эмбеддингов**

- аннотация (Annotation);
- обзор (Overview).

Исходный текст публикации не является источником эмбеддингов.

**Результат потока**  
Набор эмбеддингов, ассоциированных со смысловыми представлениями публикации.

**Инварианты потока**

- эмбеддинги являются производными смысловых представлений;
- эмбеддинги не формируются для иных текстовых артефактов;
- поток не инициирует пересчёт смысловых представлений и не имеет обратных связей.

---

## Поток сохранения корпуса и статистики

(`* → Storage`)

**Назначение**  
Сохранение результатов потоков формирования корпуса в каноническом хранилище.

**Сохраняемые данные**

- публикации и их внутренние представления;
- аннотации и обзоры;
- эмбеддинги;
- агрегированная статистика внимания.

**Свойства потока**

- состояние хранилища является каноническим по отношению ко всем пользователям;
- сохранённые данные не изменяются реактивно в ответ на пользовательское поведение;
- обновление корпуса допускается только как результат серверных потоков формирования.

---

## Ограничения

Глобальные запреты на реактивность, обратные связи и участие браузерного контекста в потоках формирования корпуса зафиксированы в `ctx/docs/architecture/data-flow.md`.

---

## Границы документа

Данный документ не описывает:

- источники публикаций и способы их получения;
- алгоритмы извлечения и нормализации текста;
- конкретные модели LLM и embedding;
- форматы хранения данных и API доступа;
- инженерные и эксплуатационные решения.

Эти вопросы относятся к другим слоям документации.

---

## Итог

Документ фиксирует потоки формирования корпуса данных Mindstream как замкнутую серверную систему, формирующую канонический корпус смысловых данных без участия пользовательского контекста, без глобальной реактивности и без управляющих обратных связей в рамках MVP.
