# Text Extraction in Ingestion Pipeline

## 1. Назначение и область действия

Данный документ фиксирует архитектурные инварианты и границы ответственности процесса извлечения текста публикаций во входном контуре (Ingestion) системы Mindstream.

Извлечение текста рассматривается как техническая операция нормализации внешнего HTML-представления публикации в детерминированное текстовое представление, пригодное для последующей смысловой обработки. Документ не описывает конкретные алгоритмы, селекторы, HTML-теги или правила парсинга конкретных источников.

Документ применяется исключительно к контуру Ingestion и не распространяется на этапы Processing, Storage или Product Layer.

## 2. Статус извлечённого текста

Извлечённый текст публикации не является каноническим артефактом публикации в системе.

Он используется исключительно как исходный материал для формирования вторичных канонических артефактов:

- аннотации публикации;
- обзора публикации.

Каноническими артефактами публикации в системе считаются:

- источник;
- заголовок публикации;
- автор публикации;
- дата публикации;
- аннотация;
- обзор.

Извлечённый текст не предназначен для прямого использования в пользовательском интерфейсе и не рассматривается как продуктовый контент.

## 3. Хранение оригинального HTML

Оригинальный HTML-код публикации может сохраняться во временном хранилище системы с ограниченным сроком жизни (TTL до 3 суток).

Назначение временного хранения HTML:

- аудит корректности ingestion;
- отладка источников публикаций;
- повторное извлечение текста в случае дефектов ingestion.

Оригинальный HTML не является каноническим артефактом и не рассматривается как часть постоянного корпуса данных системы.

## 4. Граница ответственности Ingestion

Контур Ingestion отвечает за:

- удаление HTML-разметки;
- структурную нормализацию текста;
- техническую текстовую нормализацию.

К допустимой нормализации относятся:

- схлопывание избыточных пробелов;
- схлопывание пустых строк;
- нормализация кавычек и других типографских символов;
- приведение текста к стабильному и детерминированному виду.

Контур Ingestion не выполняет:

- смысловую фильтрацию текста;
- удаление фрагментов по семантическим признакам;
- интерпретацию содержания текста;
- редактирование или переформулирование текста.

Любая смысловая обработка относится к последующим контурам системы.

## 5. Markdown как обязательный формат

Результатом извлечения текста в контуре Ingestion является текст в формате Markdown.

Markdown рассматривается как обязательный целевой формат нормализованного текстового представления публикации.

Допустимые элементы Markdown:

- заголовки;
- абзацы;
- списки;
- fenced code blocks;
- inline code;
- blockquote.

Использование HTML внутри Markdown не допускается.

Markdown используется исключительно как внутренний формат сериализации текста и не рассматривается как продуктовый формат отображения.

## 6. Обращение со ссылками и кодом

Все ссылки, присутствующие в исходной публикации, редуцируются до plain text. URL и Markdown-ссылки не сохраняются.

Кодовые фрагменты сохраняются всегда:

- блочный код сохраняется в виде fenced code blocks;
- inline code сохраняется в виде inline code.

Код рассматривается как часть текста публикации и не подлежит удалению или упрощению.

## 7. Политика строгости извлечения

Извлечение текста осуществляется по принципу «всё или ничего».

Если:

- ожидаемый контейнер основного текста публикации отсутствует;
- структура HTML не соответствует ожидаемой для данного источника;
- корректное извлечение полного текста невозможно,

публикация:

- отбрасывается;
- помечается как битая;
- не передаётся на последующие этапы обработки.

Частичное извлечение текста публикации не допускается.

## 8. Source-specific характер извлечения

Алгоритм извлечения текста является source-specific и жёстко привязан к идентификатору источника публикаций (`source_id`).

Для каждого источника публикаций применяется собственный алгоритм извлечения текста, отражающий специфику структуры HTML данного источника.

Попытки универсализации алгоритмов извлечения между источниками не являются частью MVP.

## 9. Документация для новых источников

Каждый новый источник публикаций требует отдельного архитектурного документа, описывающего инварианты извлечения текста для данного источника.

Документ `text-extraction.md` фиксирует только общие архитектурные границы и принципы и не заменяет source-specific документацию.

## 10. Ограничения документа

Настоящий документ:

- не содержит псевдокода;
- не содержит таблиц соответствий HTML → Markdown;
- не описывает конкретные селекторы, теги или DOM-структуры;
- не фиксирует реализационные детали.

Документ предназначен для использования как когнитивный контекст при разработке ingestion-контура и для последующей обработки LLM на этапах формирования аннотаций и обзоров.
