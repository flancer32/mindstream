# Feed View DTO

Path: `ctx/docs/architecture/feed-view-dto.md`

## Назначение

**Feed View DTO** — это архитектурно зафиксированный контракт доставки данных из backend-приложения в браузер для формирования пользовательской ленты Mindstream.

Feed View DTO является read-only представлением и используется исключительно в рамках Frontend Data Ingress. Он определяет минимально достаточную структуру данных для рендера ленты и локальных вычислений интересов пользователя в MVP.

---

## Архитектурная роль

Feed View DTO:

- формируется на стороне backend;
- доставляется в браузер через HTTP API;
- является самодостаточным и не требует дополнительных запросов;
- не отражает структуру хранения данных в БД;
- не содержит write-инструкций или доменной логики.

Feed View DTO является **frontend-aware read-model**, допускающим использование части данных (включая embeddings) для локальных вычислений в браузере, но не раскрывающим внутреннюю архитектуру backend.

---

## Состав Feed View DTO (MVP)

Feed View DTO состоит из двух логических частей:

1. встроенного кодификатора источников публикаций;
2. списка элементов ленты.

---

## Кодификатор источников

Кодификатор источников передаётся **в составе Feed View DTO** и используется фронтом как справочник для отображения источников публикаций.

```ts
SourceDictionaryItemDto {
  code: string;
  name: string;
  url: string;
}
```

Кодификатор:

- формируется на стороне backend на основе актуальных данных хранения;
- не хранится персистентно как отдельная сущность;
- не имеет собственного жизненного цикла;
- используется фронтом исключительно для разрешения `sourceCode` в UI.

---

## Элемент ленты (Feed Item)

```ts
FeedItemDto {
  id: number;

  sourceCode: string;

  title?: string;
  url: string;

  publishedAt?: string;

  annotation: string;
  overview: string;

  embeddings: {
    annotation: number[];
    overview: number[];
  };
}
```

### Принципиальные положения

- `sourceCode` используется для разрешения источника через встроенный кодификатор;
- технические поля хранения, служебные идентификаторы и статусы публикаций в DTO отсутствуют;
- embeddings передаются в сериализованном виде и доступны фронту для локальных вычислений интересов пользователя;
- фронт не знает и не должен знать способ генерации embeddings и используемые модели.

---

## Контейнер Feed View

```ts
FeedViewDto {
  sources: SourceDictionaryItemDto[];
  items: FeedItemDto[];
  cursor?: {
    publishedAt?: string;
    id: number;
  };
}
```

### Cursor

Cursor используется исключительно как технический маркер для реализации бесконечной прокрутки. Он не является страницей, не имеет пользовательской семантики и передаётся фронтом обратно backend без интерпретации и изменений.

---

## Архитектурные ограничения MVP

В рамках MVP зафиксировано, что Feed View DTO:

- передаётся целиком одним HTTP-ответом;
- не поддерживает частичную загрузку кодификатора;
- не содержит пользовательских состояний;
- не поддерживает live-обновления;
- не расширяется дополнительными вложенными представлениями.

Любое расширение Feed View DTO за пределами MVP требует явного архитектурного решения и обновления данного документа.

---

## Связь с другими архитектурными документами

- Frontend Data Ingress определяет канал доставки Feed View DTO.
- HTTP Ingress определяет внешний HTTP-контур, через который передаётся Feed View DTO.
- Реализация формирования Feed View DTO относится к backend read-сервисам и не фиксируется в данном документе.
- Референсная реализация DTO размещается в `web/app/Shared/Dto` и использует namespace `Mindstream_Shared_Dto_`.
