# Deployment Environment — MVP

Path: `ctx/docs/environment/deployment.md`

## Назначение

Документ фиксирует **нормативную форму развёртывания MVP Mindstream** как часть продукта.  
Он описывает инвариантную модель деплоя, роли компонентов и границы их ответственности без перехода к инструкциям, конфигурациям и операционным процедурам.

Форма деплоя считается частью продукта MVP и подлежит воспроизведению во всех средах исполнения.

## Статус деплоя в MVP

В рамках MVP считается истинным, что:

- модель деплоя Mindstream **жёстко зафиксирована**;
- деплой является **частью продукта**, а не эксплуатационным выбором;
- среды `dev` и `prod` различаются параметрами и способом запуска, но **не формой развёртывания**;
- архитектурная форма системы не зависит от среды исполнения.

## Общая форма развёртывания

MVP Mindstream развёртывается в форме:

**Apache → Node.js application → PostgreSQL**

где Apache является единственной внешней точкой входа, а Node.js-приложение функционирует исключительно за прокси-сервером.

## HTTPS и требования PWA

Клиентская часть Mindstream реализуется в форме **Progressive Web App (PWA)**.

В рамках MVP считается истинным, что:

- HTTPS является **обязательным условием** эксплуатации продукта;
- доступ к продукту по HTTP без TLS не допускается;
- обеспечение TLS относится к ответственности веб-сервера.

## Роль Apache

Apache является **обязательным компонентом MVP** и является единственной внешней HTTPS-точкой входа системы.

В рамках MVP Apache:

- обслуживает клиентскую статику напрямую;
- проксирует API-запросы в серверное приложение;
- реализует любые политики доступа к backend, включая фильтрацию, ограничение и модификацию запросов;
- завершает TLS-соединения.

Apache рассматривается как полноценный reverse proxy, обладающий полной свободой в обработке входящих HTTP-запросов.

## Статика и клиентская часть

Клиентская часть Mindstream:

- представляет собой **чистую статическую PWA** (HTML / JavaScript / CSS);
- не использует server-side rendering;
- не использует build-этап;
- обслуживается Apache напрямую без участия Node.js.

Статические ресурсы имеют **версию**, рассматриваемую как часть продукта и используемую в контексте PWA.

Передача статических ресурсов через Node.js в рамках MVP не допускается.

## API и маршрутизация

В рамках MVP существует **ровно один API namespace**:

- `/api/*`

Иные namespaces, версии API, служебные или диагностические пути отсутствуют.

Apache вправе произвольно модифицировать API-запросы, включая заголовки и маршруты, при условии сохранения единого публичного namespace `/api/*`.

## Node.js приложение

Серверная часть Mindstream реализуется в виде Node.js-приложения.

В рамках MVP считается истинным, что:

- Node.js-приложение обслуживает **исключительно API-контур**;
- приложение не раздаёт статические ресурсы;
- приложение не доступно напрямую из внешней сети;
- приложение слушает только внутренний интерфейс, предназначенный для взаимодействия с Apache.

### Режимы запуска

- В среде `prod` Node.js-приложение запускается в **кластерном режиме под управлением PM2**.
- В среде `dev` допускается запуск без PM2 в однопроцессном режиме.

Выбор PM2 зафиксирован для MVP как нормативный для production-среды.

## Консольный доступ и задачи

Кодовая база Mindstream предусматривает возможность:

- запуска серверного приложения из командной строки;
- выполнения вспомогательных и сервисных задач вне HTTP-контекста.

Наличие CLI-доступа не изменяет сетевые и архитектурные границы деплоя и не предполагает внешнего HTTP-доступа к Node.js.

## Границы ответственности компонентов

В рамках MVP считается истинным, что:

- Apache отвечает за:
  - TLS;
  - приём внешних HTTP(S)-запросов;
  - раздачу статики;
  - проксирование и контроль доступа к API;
- Node.js-приложение отвечает за:
  - обработку API-запросов;
  - реализацию серверной логики;
  - доступ к серверному хранилищу данных;
- прямое пересечение ролей компонентов отсутствует.

## Границы документа

Документ:

- не содержит инструкций по настройке;
- не содержит команд, конфигурационных файлов и путей;
- не фиксирует операционные процедуры;
- не описывает альтернативные модели деплоя;
- не вводит требований к облачной или сетевой инфраструктуре.

Документ фиксирует **форму**, а не процесс её реализации.

## Итог

`deployment.md` закрепляет модель развёртывания MVP Mindstream как жёстко зафиксированную часть продукта, в которой Apache выступает единственной внешней точкой входа и прокси-уровнем, Node.js реализует API-контур за внутренним интерфейсом, клиентская часть функционирует как PWA по HTTPS, а различия сред исполнения не затрагивают архитектурную форму системы.
