# Code CLI — Command Tree

Path: `ctx/docs/code/cli/command-tree.md`

## Назначение

Документ фиксирует каноническое пространство допустимых CLI-команд backend-приложения Mindstream. Он определяет иерархию команд, их назначение и форму входных параметров. Документ является нормативным и представляет скелет CLI-пространства; код CLI обязан соответствовать данному реестру.

---

## Иерархия команд

```
db:schema:create
ingest:discover:habr
ingest:extract:habr
runtime:serve
```

Команды, отсутствующие в данной иерархии, считаются недопустимыми.

---

## Реестр команд

### db:schema:create

Контур: maintenance.

Назначение: создание схемы данных приложения в пустой базе данных.

Параметры:

- отсутствуют.

Ограничения:

- предполагает пустую базу данных;
- создаёт только структуру БД (tables, indexes, constraints);
- не идемпотентна;
- не выполняет миграции;
- не используется в runtime-контуре.

---

### ingest:discover:habr

Контур: ingest.

Назначение: обнаружение публикаций из RSS Хабра и фиксация их в системе как известных публикаций без загрузки текста и без инициирования processing.

Параметры:

- отсутствуют.

Ограничения:

- использует хардкодированный RSS URL источника Habr;
- выполняет только discovery;
- не выполняет fetch HTML;
- не извлекает текст публикаций;
- идемпотентна;
- допускает повторные запуски без изменения результата;
- не инициирует processing и не влияет на runtime-контур.

### ingest:extract:habr

Контур: ingest.

Назначение: получение HTML публикаций Хабра и извлечение md-текста в рамках ingestion-контура без инициирования последующих этапов обработки.

Параметры:

- отсутствуют.

Ограничения:

- извлекает md-текст только для публикаций со статусом ожидания извлечения;
- сохраняет HTML и md-текст как временные артефакты ingestion-контура;
- использует source-specific извлечение для Habr;
- идемпотентна и допускает повторные запуски без изменения результата;
- не инициирует processing и не влияет на runtime-контур.

### runtime:serve

Контур: runtime.

Назначение: запуск backend-приложения в runtime-режиме.

Параметры:

- отсутствуют.

Ограничения:

- не является операцией с результатом;
- не предполагает нормального завершения;
- не используется в maintenance-контуре.

---

## Общие инварианты CLI-команд

Для всех CLI-команд приложения зафиксированы следующие инварианты:

- команды строго неинтерактивны;
- команды детерминированы при фиксированном окружении и данных;
- команды работают в доверенном контуре;
- команды не управляют завершением процесса напрямую.

---

## Границы документа

Документ не описывает бизнес-логику команд, алгоритмы выполнения, побочные эффекты, реализацию в коде, порядок вызова внутренних сервисов или формат пользовательского вывода. Любые изменения пространства CLI-команд требуют явного изменения данного документа.
