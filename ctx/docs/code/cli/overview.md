# Code CLI — Overview

Path: `ctx/docs/code/cli/overview.md`

## Назначение

Документ фиксирует рамочную модель CLI в MVP Mindstream.

Он задаёт нормативные инварианты слоя CLI, определяющие его статус, границы ответственности и отношение к backend-приложению.

---

## Статус CLI

В MVP Mindstream CLI является частью backend-приложения.

CLI:

- не является отдельным приложением;
- не имеет собственного жизненного цикла вне backend-приложения;
- не образует самостоятельный архитектурный контур.

CLI используется исключительно как механизм выбора режима выполнения backend-приложения.

---

## Entry point

Backend-приложение имеет единственный entrypoint.

Все запуски backend-кода осуществляются через него и различаются только выбранной CLI-командой.

Альтернативные entrypoint и параллельные точки входа не допускаются.

---

## Режимы выполнения

Через CLI всегда запускается одно и то же backend-приложение.

CLI определяет режим выполнения приложения:

- runtime-режим;
- инженерный (maintenance) режим.

Различие между режимами является логическим и не связано с разными composition root или разными исполняемыми контурами.

---

## Классы CLI-команд

CLI-команды классифицируются по типу жизненного цикла.

### Runtime-команды

Runtime-команды инициируют runtime-режим выполнения backend-приложения.

Runtime-команда не является операцией с результатом и не предполагает нормального завершения.

---

### Инженерные команды

Инженерные команды инициируют одноразовое выполнение backend-приложения.

Инженерная команда завершается после выполнения действия и выхода из процесса.

---

## Общая прикладная основа

Независимо от выбранной CLI-команды:

- используется единый кодовый базис backend-приложения;
- используется единый DI-контейнер;
- используется единое окружение и доступ к инфраструктуре.

CLI не переключает composition root и не разделяет backend-приложение на разные исполняемые сущности.

---

## Неинтерактивность

CLI в MVP является строго неинтерактивным.

CLI:

- не использует интерактивный ввод;
- не запрашивает подтверждений;
- не предполагает диалогов во время выполнения.

Все параметры выполнения должны быть известны на старте.

---

## Общие инварианты CLI (MVP)

Для слоя CLI в MVP зафиксированы следующие инварианты:

- детерминированность выполнения при фиксированном окружении и данных;
- отсутствие интерактивности;
- работа в доверенном контуре;
- централизованная политика завершения процесса.

---

## Отношение к bootstrap и runtime

CLI не является bootstrap-слоем.

Bootstrap передаёт управление backend-приложению, а CLI определяет режим выполнения приложения после передачи управления. После возврата управления bootstrap завершает приложение и освобождает управляемые ресурсы.

Runtime-код не зависит от CLI и не содержит логики выбора режима запуска.

---

## Границы документа

Документ не описывает:

- структуру дерева CLI;
- модель диспетчеризации;
- разбор аргументов;
- семантику ошибок и exit code;
- конкретные команды MVP;
- реализацию CLI в коде.

Эти аспекты фиксируются в специализированных документах слоя `code/cli`.
