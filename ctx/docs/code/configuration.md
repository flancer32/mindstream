# Code Configuration — MVP

Path: `./ctx/docs/code/configuration.md`

## Назначение

Документ фиксирует **нормативную модель конфигурации backend-приложения Mindstream** на уровне кодового слоя.

Он определяет:

- как в проекте устроена работа с конфигурацией;
- какие инварианты считаются обязательными;
- какие источники значений допустимы.

Документ относится исключительно к слою `code/` и не вводит архитектурных, продуктовых или эксплуатационных решений.

---

## Статус конфигурации

Конфигурация backend-приложения Mindstream оформляется как **внутренний объект прикладного приложения**.

Объект конфигурации:

- не является частью runtime-контракта;
- не участвует в архитектурной модели запуска;
- не передаётся из bootstrap-кода как готовая структура;
- создаётся и используется исключительно внутри приложения.

Архитектурный и environment-слои **не оперируют** сущностью конфигурации как объектом.

---

## Единый объект конфигурации

В backend-приложении существует **ровно один** объект конфигурации: `Mindstream_Back_App_Configuration`.

- объект создаётся единственной точкой сборки в прикладном коде;
- объект присутствует в памяти процесса на протяжении всего времени работы приложения;
- объект используется как **read-only** структура и не изменяется после инициализации;
- доступ к объекту осуществляется через стандартные механизмы связывания кода (import или DI), без использования глобального состояния.

Создание дополнительных объектов конфигурации, конфигурационных дублей или альтернативных конфигурационных сервисов считается нарушением нормы.

---

## Источники значений

**Каноническим источником значений конфигурации является `process.env`.**

Другие источники значений в модели конфигурации отсутствуют.

Использование `.env` файла допускается **исключительно как механизм подготовки `process.env`** и не рассматривается как альтернативный источник конфигурации.

---

## Загрузка `.env` файла

Допускается загрузка файла `.env`, расположенного в корне проекта.

Инварианты загрузки `.env`:

- загрузка инициируется прикладным кодом при инициализации конфигурации;
- путь к корню проекта передаётся в приложение извне (через bootstrap);
- файл `.env`, если он существует, разбирается и его значения записываются в `process.env`;
- отсутствие файла `.env` не считается ошибкой;
- значения, уже присутствующие в `process.env`, не переопределяются.

Загрузка `.env` рассматривается как **подготовка среды выполнения**, а не как часть модели конфигурации.

---

## Доступ к параметрам окружения

Чтение `process.env` допускается **только** в точке инициализации `Mindstream_Back_App_Configuration`.

Прямой доступ к `process.env` в прикладных модулях, сервисах, адаптерах или инфраструктурных компонентах запрещён и считается нарушением инженерной нормы.

---

## Нормализация

Все значения из `process.env` приводятся к требуемым типам и форме **в момент инициализации объекта конфигурации**.

Объект конфигурации содержит **только нормализованные значения**, пригодные для прямого использования. Передача "сырых" строк окружения в прикладной код запрещена.

---

## Связь со структурой конфигурации

Структура конфигурационного объекта считается нормативно зафиксированной в документе:

```
ctx/docs/code/configuration/structure.md
```

Использование параметров, отсутствующих в нормативной структуре, считается дефектом кодовой базы.

---

## Границы документа

Документ не описывает:

- конкретные имена переменных окружения;
- значения параметров и значения по умолчанию;
- формат хранения секретов;
- процедуры деплоя и настройки окружения;
- архитектурную модель запуска приложения.

Эти аспекты относятся к другим уровням контекста и не фиксируются на уровне `code/`.
