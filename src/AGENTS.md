# Source Code — AGENTS

Path: `./src/AGENTS.md`

## Назначение

Документ определяет **процедурные требования к работе агента с production-кодом backend-части проекта Mindstream**, размещённым в каталоге `src/`.

Документ применяется ко всем подкаталогам `src/` и дополняет правила, зафиксированные в корневом `AGENTS.md` и в документации когнитивного контекста проекта (`ctx/`).

Документ **не фиксирует инженерные инварианты кода** и **не дублирует нормативные требования**, описанные в `ctx/docs/code/`.  
Его задача — определить, **какие действия обязан выполнить агент и какой нормативный контекст он обязан загрузить** перед работой с backend-кодом.

---

## Карта уровня

- `src/` — исходный production-код **backend-части** проекта Mindstream.
- `AGENTS.md` — текущий документ; процедурные требования к действиям агента при изменении backend-кода данного уровня.

Код shared-слоёв **не относится** к данному уровню и расположен в `web/app/Shared`.

---

## Границы ответственности агента

В каталоге `src/` агент:

- изменяет **только backend-код** проекта Mindstream;
- действует исключительно в рамках зафиксированной DI-модели проекта;
- не расширяет scope продукта без явного указания человека;
- не вводит инженерные допущения, отсутствующие в документации контекста.

Перед внесением любых изменений агент **обязан загрузить в рабочий контекст нормативные документы кодового слоя**, применимые к backend-коду, включая как минимум:

- `ctx/docs/code/es6-modules.md` — нормативная форма ES6-модулей проекта;
- `ctx/docs/code/di-compatibility.md` — жёсткие инварианты DI-модели `@teqfw/di`;
- `ctx/docs/code/conventions.md` — базовые инженерные конвенции кода;
- `ctx/docs/code/testing.md` — инварианты тестирования кодового слоя.

Несоблюдение любого из указанных нормативов трактуется как дефект кодовой базы, а не как стилевое отклонение.

---

## Требование выполнения тестов

Любое изменение production-кода в каталоге `src/` требует обязательной проверки unit-тестами.

Агент обязан:

- после внесения изменений выполнить команду `npm run test:unit`;
- убедиться, что тесты завершились без ошибок;
- зафиксировать факт выполнения тестов и их результат в отчёте итерации.

---

## Поведение при сбое тестов

Если выполнение `npm run test:unit` завершается с ошибками, агент обязан:

- не считать задачу завершённой;
- либо исправить код и повторно запустить тесты;
- либо явно зафиксировать причину сбоя в отчёте итерации и передать решение человеку.

Внесение изменений в backend-код без успешного выполнения тестов считается некорректным.

---

## Запрещённые действия

В каталоге `src/` агенту запрещено:

- вносить изменения в backend-код без загрузки нормативного контекста кодового слоя;
- вносить изменения без последующего запуска unit-тестов;
- заявлять о завершении задачи при наличии падающих тестов;
- обходить или игнорировать тестовую инфраструктуру проекта;
- подменять соблюдение нормативных требований субъективной оценкой корректности кода.

---

## Итоговое требование

Изменения backend-кода в `src/` **не считаются валидными**, если:

- агент не загрузил обязательные нормативные документы кодового слоя;
- изменения не соответствуют зафиксированным инженерным инвариантам;
- изменения не подтверждены успешным выполнением `npm run test:unit`;
- результаты тестов не отражены в отчёте итерации.
